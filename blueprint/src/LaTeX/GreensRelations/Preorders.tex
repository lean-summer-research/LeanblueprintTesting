% This file is included by both the web and print versions of the blueprint
% via an import statment in blueprint/scr/content.tex 

\section{Green's Preorders}

Green's preorders are traditionally defined for semigroups by adjoining a unit element and working in the resulting monoid.  Here we start directly with monoids, thereby avoiding the overhead of the `WithOne` construction and the need to explicitly adjoin an identity.  Since a semigroup with an adjoined unit is essentially the same as a monoid, working on monoids simplifies many of the subsequent proofs.  In future developments this code might be refactored to operate on semigroups with a unit, but the monoid formulation suffices for our purposes.

\begin{definition}[Green's R-preorder]
\label{def:RRel}
Let \(M\) be a monoid and let \(x,y\in M\).  We define
\(x \le_R y\) if there exists \(z\in M\) such that \(x = y\cdot z\).
Equivalently, \(x\) lies in the principal right ideal generated by \(y\).
% Lists the Lean declarations corresponding to this definition
\lean{RRel}
% Marks that the surrounding environment is completely formalised in Lean
\leanok
\end{definition}
\begin{lemma}[Reflexivity of \(\le_R\)]
\label{lem:RRel-refl}
For every \(x\in M\), \(x \le_R x\).
\lean{RRel.refl}
\leanok
\uses{def:RRel}
\end{lemma}

\begin{lemma}[Transitivity of \(\le_R\)]
\label{lem:RRel-trans}
For all \(x,y,z\in M\), if \(x \le_R y\) and \(y \le_R z\) then \(x \le_R z\).
\lean{RRel.trans}
\leanok
\uses{def:RRel}
\end{lemma}
\begin{proof}
\leanok
Suppose \(x \le_R y\) and \(y \le_R z\).  By definition there exist \(v,u\in M\) with \(x = y\cdot v\) and \(y = z\cdot u\).  Taking the witness \(u\cdot v\) we compute \(z\cdot(u\cdot v) = (z\cdot u)\cdot v = y\cdot v = x\), so \(x \le_R z\).
\uses{def:RRel}
\end{proof}

\begin{lemma}[Right preorder instance]
\label{lem:RRel-isPreorder}
The relation \(\le_R\) is a preorder on \(M\).
\lean{RRel.isPreorder}
\leanok
\uses{def:RRel, lem:RRel-refl, lem:RRel-trans}
\end{lemma}

\begin{definition}[Green's L-preorder]
\label{def:LRel}
Let \(M\) be a monoid and let \(x,y\in M\).  We define
\(x \le_L y\) if there exists \(z\in M\) such that \(x = z\cdot y\).
In other words, \(x\) lies in the principal left ideal generated by \(y\).
\lean{LRel}
\leanok
\end{definition}
\begin{lemma}[Reflexivity of \(\le_L\)]
\label{lem:LRel-refl}
For every \(x\in M\), \(x \le_L x\).
\lean{LRel.refl}
\leanok
\uses{def:LRel}
\end{lemma}
\begin{proof}
\leanok
Fix \(x\in M\).  To show \(x \le_L x\) we need a witness \(z\) with \(z\cdot x = x\).  Taking \(z=1\) works since \(1\cdot x = x\).
\uses{def:LRel}
\end{proof}

\begin{lemma}[Transitivity of \(\le_L\)]
\label{lem:LRel-trans}
For all \(x,y,z\in M\), if \(x \le_L y\) and \(y \le_L z\) then \(x \le_L z\).
\lean{LRel.trans}
\leanok
\uses{def:LRel}
\end{lemma}
\begin{proof}
\leanok
Suppose \(x \le_L y\) and \(y \le_L z\).  There exist \(u,v\in M\) with \(u\cdot y = x\) and \(v\cdot z = y\).  Taking the witness \(u\cdot v\) gives \((u\cdot v)\cdot z = u\cdot (v\cdot z) = u\cdot y = x\), so \(x \le_L z\).
\uses{def:LRel}
\end{proof}

\begin{lemma}[Left preorder instance]
\label{lem:LRel-isPreorder}
The relation \(\le_L\) is a preorder on \(M\).
\lean{LRel.isPreorder}
\leanok
\uses{def:LRel, lem:LRel-refl, lem:LRel-trans}
\end{lemma}

\begin{definition}[Green's J-preorder]
\label{def:JRel}
Let \(M\) be a monoid and let \(x,y\in M\).  We define
\(x \le_J y\) if there exist \(u,v\in M\) such that \(x = u\cdot y\cdot v\).
Equivalently, \(x\) lies in the twoâ€‘sided ideal generated by \(y\).
\lean{JRel}
\leanok
\end{definition}
\begin{lemma}[Reflexivity of \(\le_J\)]
\label{lem:JRel-refl}
For every \(x\in M\), \(x \le_J x\).
\lean{JRel.refl}
\leanok
\uses{def:JRel}
\end{lemma}
\begin{proof}
\leanok
Fix \(x\in M\).  To see \(x \le_J x\) we need witnesses \(u,v\) with \(x = u\cdot x \cdot v\).  Choosing \(u=1\) and \(v=1\) we have \(1\cdot x\cdot 1 = x\), so \(x \le_J x\).
\uses{def:JRel}
\end{proof}

\begin{lemma}[Transitivity of \(\le_J\)]
\label{lem:JRel-trans}
For all \(x,y,z\in M\), if \(x \le_J y\) and \(y \le_J z\) then \(x \le_J z\).
\lean{JRel.trans}
\leanok
\uses{def:JRel}
\end{lemma}
\begin{proof}
\leanok
Suppose \(x \le_J y\) and \(y \le_J z\).  Then there exist \(u_1,v_1\in M\) with \(u_1\cdot y\cdot v_1 = x\) and \(u_2,v_2\in M\) with \(u_2\cdot z\cdot v_2 = y\).  Setting \(u = u_1\cdot u_2\) and \(v = v_2\cdot v_1\), associativity shows that \(u\cdot z\cdot v = u_1\cdot u_2\cdot z\cdot v_2\cdot v_1 = u_1\cdot y\cdot v_1 = x\).  Hence \(x \le_J z\).
\uses{def:JRel}
\end{proof}

\begin{lemma}[J preorder instance]
\label{lem:JRel-isPreorder}
The relation \(\le_J\) is a preorder on \(M\).
\lean{JRel.isPreorder}
\leanok
\uses{def:JRel, lem:JRel-refl, lem:JRel-trans}
\end{lemma}

\begin{definition}[Green's H-preorder]
\label{def:HRel}
Let \(M\) be a monoid and let \(x,y\in M\).  We define
\(x \le_H y\) if both \(x \le_R y\) and \(x \le_L y\) hold, that is,
\(x\) is simultaneously in the right and left ideals generated by \(y\).
Unwinding the definition, this means there exist elements \(z_1,z_2\in M\)
with \(x = y\cdot z_1\) and \(x = z_2\cdot y\).
\lean{HRel}
\leanok
\end{definition}
\begin{lemma}[Reflexivity of \(\le_H\)]
\label{lem:HRel-refl}
For every \(x\in M\), \(x \le_H x\).
\lean{HRel.refl}
\leanok
\uses{def:HRel}
\end{lemma}
\begin{proof}
\leanok
To show \(x \le_H x\) we must exhibit both \(x \le_R x\) and \(x \le_L x\).  These are provided by the reflexivity lemmas for the right and left preorders.  Hence \(x \le_H x\).
\uses{def:HRel, lem:RRel-refl, lem:LRel-refl}
\end{proof}

\begin{lemma}[Transitivity of \(\le_H\)]
\label{lem:HRel-trans}
For all \(x,y,z\in M\), if \(x \le_H y\) and \(y \le_H z\) then \(x \le_H z\).
\lean{HRel.trans}
\leanok
\uses{def:HRel}
\end{lemma}
\begin{proof}
\leanok
Assume \(x \le_H y\) and \(y \le_H z\).  Then \(x \le_R y\) and \(x \le_L y\), while \(y \le_R z\) and \(y \le_L z\).  By transitivity of the right preorder we have \(x \le_R z\), and by transitivity of the left preorder we have \(x \le_L z\).  Therefore \(x \le_H z\).
\uses{def:HRel, lem:RRel-trans, lem:LRel-trans}
\end{proof}

\begin{lemma}[H preorder instance]
\label{lem:HRel-isPreorder}
The relation \(\le_H\) is a preorder on \(M\).
\lean{HRel.isPreorder}
\leanok
\uses{def:HRel, lem:HRel-refl, lem:HRel-trans}
\end{lemma}
